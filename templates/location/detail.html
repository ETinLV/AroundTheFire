{% extends 'base.html' %}
{% load bootstrap3 %}
{% load staticfiles %}
{% block title %}
    {{ location.name }}
{% endblock %}

{% block pane-one-title %}
    {{ location.name }}
{% endblock %}

{% block pane-one %}
{#    TODO: Style this, get rid of the BR's and inline style#}
    <p>{{ location.city }}</p>
    <br>
    {% if photos %}
        <img src="{{ photos.0.url }}" height="200px" width="200px">
        <br><BR>
    <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal">See More Photos</button>
    {% else %}
        <p>There Are No Photos For This Location <a href="{% url 'image_upload' location.id %}">Upload One?</a></p>
    {% endif %}
    <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#createTripModal">Create a Trip Here</button>


{% endblock %}


{% block pane-two-title %}
    Reviews
{% endblock %}

{% block pane-two %}

        <p>Average Rating = X.X</p>
    <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal">See Reviews</button>

{% endblock %}

{% block pane-three-title %}

{% endblock %}

{% block pane-three %}
    <iframe id="forecast_embed" type="text/html" frameborder="0" height="245"
            width="100%"
            src="http://forecast.io/embed/#lat={{ location.lat }}&lon={{ location.lng }}&name={{ location.name }}"></iframe>
{% endblock %}

{% block modal %}
    <div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">User Reviews</h4>
      </div>
      <div class="modal-body">

            <h4>Been Here? Leave a Review!</h4>
            <form method="post" action="{% url 'review_create' pk=location.pk %}">
            {% csrf_token %}
                <div class="form-group">
                <label for="reviewContent">How Was Your Trip?</label>
                <textarea name='content' class="form-control" id="reviewContent" placeholder="Here's my Story" rows="3"></textarea>
                <input type="hidden" name='location' value="{{ location.pk }}">
                </div>
                <input type="submit" value="Leave A Review" class="btn btn-success">
            </form>

        {% for review in location.reviews.all %}
          <h5>{{ review.owner }} @ {{ review.created_at }}</h5>
          <p>{{ review.content }}</p>
        {% endfor %}

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
    <div id="createTripModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Trip Messages</h4>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'trip_create' location.id %}">
        {% csrf_token %}
        <div class="form-group"><label class="sr-only" for="id_start_date">Start date</label><input class="form-control" id="id_start_date" name="start_date" placeholder="Start date" required="required" title="" type="text" /></div>
        <div class="form-group"><label class="sr-only" for="id_end_date">End date</label><input class="form-control" id="id_end_date" name="end_date" placeholder="End date" required="required" title="" type="text" /></div>
        <div class="form-group"><label class="sr-only" for="id_title">Title</label><input class="form-control" id="id_title" maxlength="50" name="title" placeholder="Title" required="required" title="" type="text" /></div>
        <div class="form-group"><label class="sr-only" for="id_description">Description</label><textarea class="form-control" cols="40" id="id_description" maxlength="500" name="description" placeholder="Description" rows="10" title="">
        </textarea></div>
        <div class="form-group"><label class="sr-only" for="id_max_capacity">Max capacity</label><input class="form-control" id="id_max_capacity" name="max_capacity" placeholder="Max capacity" required="required" title="" type="number" /></div>
        <div class="form-group"><label class="sr-only" for="id_invited">Invited</label><select multiple="multiple" class="form-control" id="id_invited" name="invited" title="">
        <option value="1">test</option>
        <option value="2">person3</option>
        </select></div>
        <input type="submit" value="Create A Trip" class="btn btn-success">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block javascript %}
<script>
    var iconBase = '{% static 'icons/' %}';
    var icons = {
      invited: {
        icon: iconBase + 'purplefire.png'
      },
      upcoming: {
        icon: iconBase + 'redfire.png'
      },
      past: {
        icon: iconBase + 'blackfire.png'
      },
      home: {
          icon: iconBase + 'home.png'
      },
      campsite: {
          icon: iconBase + 'campsite.png'
      }
    };
    function initMap() {
        var defautLat = Number({{ location.lat }});
        var defautLng = Number({{ location.lng }});
        var myLatLng2 = {lat: defautLat, lng: defautLng};
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 14,
            center: myLatLng2,
            mapTypeId: google.maps.MapTypeId.TERRAIN
        });
        //loop thought locations and call the marker place functions

        placeMarker();

        //adds markers for each trip type
        //place a marker on the center of the map
        function placeMarker() {
            var marker = new google.maps.Marker({
                map: map,
                position: {
                    lat: defautLat,
                    lng: defautLng
                },
                icon: icons['campsite'].icon
            });
            {#            var infowindow = new google.maps.InfoWindow({#}
            {#                content: (invited[0].fields.name.link('location/'+invited[0].pk))#}
            {##}
            {#            });#}
            {#            google.maps.event.addListener(marker, 'click', function () {#}
            {#                infowindow.open(map, marker);#}
            {#            });#}
        }
    }
</script>
{% endblock %}



